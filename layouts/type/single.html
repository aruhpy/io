{{ define "main" }}
<main class="type-main">

  <!-- ✅ 페이지 타이틀 -->
  <h1 class="type-page-title">{{ .Title }}</h1>

  <!-- ✅ 샘플 슬라이더 (webp 우선, 없으면 기존 확장자) -->
  {{ $imgs := .Resources.Match "img/*.webp" }}
  {{ if eq (len $imgs) 0 }}
    {{ $imgs = .Resources.Match "img/*" }}
  {{ end }}

  {{ if gt (len $imgs) 0 }}
  <section class="type-sample">
    <div class="type-gallery-slider" id="typeGallery">
      {{ range $imgs }}
      <figure class="type-gallery-slide">
        <button class="type-gallery-open" type="button" data-src="{{ .RelPermalink }}" aria-label="이미지 크게 보기">
          <img src="{{ .RelPermalink }}" alt="샘플 이미지" loading="lazy" draggable="false">
        </button>
      </figure>
      {{ end }}
    </div>
    <p class="type-sample-hint">좌우로 밀어서 더 많은 샘플을 볼 수 있어요.</p>
  </section>

  <!-- ✅ 라이트박스 -->
  <div class="type-lightbox" id="typeLightbox" aria-hidden="true">
    <div class="type-lightbox__backdrop" data-close="1"></div>
    <div class="type-lightbox__panel" role="dialog" aria-modal="true" aria-label="샘플 크게보기">
      <button class="type-lightbox__close" type="button" data-close="1" aria-label="닫기">×</button>
      <img class="type-lightbox__img" id="typeLightboxImg" alt="샘플 크게 보기">
    </div>
  </div>
  {{ end }}


  <!-- ✅ 가격 메뉴 -->
  {{ with .Params.price }}
  <section class="type-box type-price">
    <div class="type-menu">
      {{ range .rows }}
      <div class="type-menu-row">
        <div class="type-menu-left">{{ .label }}</div>
        <div class="type-menu-dots"></div>
        <div class="type-menu-right">{{ .value }}</div>

        {{ with .sub }}
        <div class="type-menu-sub">{{ . }}</div>
        {{ end }}
      </div>
      {{ end }}
    </div>
  </section>
  {{ end }}

  <!-- ✅ 신청양식 + 주의사항(♡) 합본 박스 -->
  <section class="type-box type-combo">
    <div class="type-box-title">신청 양식</div>

    <div class="type-combo-inner">

      {{ with .Params.form }}
   <div class="type-formlist">
  {{ range . }}
  <div class="type-formrow">
    <div class="type-formlabel">{{ .label }}</div>
    <div class="type-formcolon">:</div>
    <div class="type-formvalue"></div>

    {{ with .hint }}
    <div class="type-formhint">{{ . }}</div>
    {{ end }}
  </div>
  {{ end }}
</div>
{{ end }}

      <div class="type-dots-divider" aria-hidden="true"></div>

      {{ with .Params.notes }}
      <ul class="type-heartlist">
        {{ range . }}
        <li class="type-heart-item">
          <span class="type-heart-icon">♡ഒ</span>
          <span class="type-heart-text">{{ . }}</span>
        </li>
        {{ end }}
      </ul>
      {{ end }}

    </div>
  </section>

  <!-- ✅ 불가 주민(검색/칩) — 신청양식 박스 밖(별도), 프레임 안 -->
  {{ with .Params.ban_residents }}
  <section class="type-box type-ban">
    <details class="type-accordion">
      <summary class="type-accordion-summary">불가주민</summary>

      <div class="type-ban-wrap">
        <div class="type-ban-searchrow">
          <input
            class="type-ban-search"
            type="text"
            placeholder="이름 검색..."
            autocomplete="off"
            inputmode="search"
          />
          <button
            class="type-ban-clear"
            type="button"
            aria-label="검색어 지우기"
            hidden
          >×</button>
        </div>

        <p class="type-ban-empty" hidden>해당 주민 없음</p>

        <div class="type-ban-chips">
          {{ range . }}
          <button class="type-ban-chip" type="button" data-name="{{ . }}">{{ . }}</button>
          {{ end }}
        </div>
      </div>
    </details>
  </section>
  {{ end }}

</main>

<script>
(function(){
  /* =========================================
     불가주민 검색 + X 버튼
     - 섹션이 없으면 조용히 종료
  ========================================= */
  const banWrap = document.querySelector(".type-ban-wrap");
  if (banWrap) {
    const input = banWrap.querySelector(".type-ban-search");
    const clearBtn = banWrap.querySelector(".type-ban-clear");
    const chipsWrap = banWrap.querySelector(".type-ban-chips");
    const emptyMsg = banWrap.querySelector(".type-ban-empty");

    if (input && clearBtn && chipsWrap && emptyMsg) {
      const chips = Array.from(chipsWrap.querySelectorAll(".type-ban-chip"));

      function norm(s) {
        return (s || "").toString().replace(/\s+/g, "").toLowerCase();
      }

      function applyFilter() {
        const raw = input.value || "";
        const q = norm(raw);

        // X 버튼 표시/숨김
        clearBtn.hidden = raw.trim().length === 0;

        let visible = 0;
        for (const chip of chips) {
          const name = norm(chip.getAttribute("data-name") || chip.textContent);
          const match = q === "" || name.includes(q);
          chip.hidden = !match;
          if (match) visible++;
        }

        // 검색어가 있고 결과가 0이면 안내 표시
        emptyMsg.hidden = !(q !== "" && visible === 0);
      }

      function clearSearch() {
        input.value = "";
        applyFilter();
        input.focus();
      }

      input.addEventListener("input", applyFilter);
      input.addEventListener("keydown", function (e) {
        if (e.key === "Escape") clearSearch();
      });
      clearBtn.addEventListener("click", clearSearch);

      // (선택) 칩 클릭하면 그 이름으로 검색어 채우기
      for (const chip of chips) {
        chip.addEventListener("click", function () {
          input.value = (chip.textContent || "").trim();
          applyFilter();
          input.focus();
        });
      }

      // 초기 상태 적용
      applyFilter();
    }
  }

  /* =========================================
     라이트박스
  ========================================= */
  const lb = document.getElementById("typeLightbox");
  const lbImg = document.getElementById("typeLightboxImg");
  const gallery = document.getElementById("typeGallery");

  if (gallery && lb && lbImg) {
    if (lb.parentElement !== document.body) {
      document.body.appendChild(lb);
    }

    gallery.addEventListener("click", (e) => {
      const btn = e.target.closest(".type-gallery-open");
      if (!btn) return;
      const src = btn.getAttribute("data-src");
      if (!src) return;

      lbImg.src = src;
      lb.classList.add("is-open");
      lb.setAttribute("aria-hidden", "false");
    });

    lb.addEventListener("click", (e) => {
      const closeBtn = e.target.closest('[data-close="1"]');
      if (!(closeBtn || e.target === lb)) return;

      lb.classList.remove("is-open");
      lb.setAttribute("aria-hidden", "true");
      lbImg.removeAttribute("src");
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && lb.classList.contains("is-open")) {
        lb.classList.remove("is-open");
        lb.setAttribute("aria-hidden", "true");
        lbImg.removeAttribute("src");
      }
    });
  }
})();
</script>

{{ end }}

